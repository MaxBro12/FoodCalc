# Blocker Service

Это сервис блокировки IP-адресов.

## Установка в других приложениях

В файле `fast_api_middleware.py` написана минимальная реализация, добавьте это в свой код. Не в коем случие не импортируйте этот файл в свой код. Это лишь пример, который можно использовать в качестве отправной точки для реализации своей логики. Например необходимо указать свое приложение FastAPI(), подключить настройки и создать нужные .env параметры.

## Эндпоинты

- `GET /v1/bans`: Получение списка заблокированных и белых IP-адресов. Доступны параметры пагинации `skip` и `limit` для корректной работы требуется указать оба параметра.
- `GET /v1/bans/{ip_address}`: Находится ли указанный IP адрес в списке заблокированных, если ip сохранен как белый он всегда будет возвращать `false`.
- `DELETE /v1/bans/{ip_address}`: Разблокировка IP-адреса, так же удаляются и белые адреса.
- `POST /v1/bans`: Блокировка IP-адреса, так же добавляются и белые адреса. Параметры:
  - `ip`: str IP-адрес для блокировки или добавления в белый список.
  - `reason`: str причина блокировки, лучше указывать от какого приложения поступила блокировка а так же какова причина.
  - `duration_days`: int Длительность блокировки в днях. Если не указано, считается 3 дня.
  - `permament`: bool Если `true`, то блокировка будет постоянной.
  - `white`: bool Если `true`, то IP-адрес будет добавлен в белый список на постоянной основе.

## DB модели

### Bans

|name|type|desc|
|----|----|----|
|ip|VARCHAR PRIMARY KEY| ip адрес пользователя |
|reason|VARCHAR UNIQUE| причина блокировки |
|date_unban|DATETIME| дата разблокировки |
|permanent|bool| является ли блокировка постоянной |
|white|bool| является ли IP адрес белым |
